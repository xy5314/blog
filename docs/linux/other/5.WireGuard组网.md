---
id: other-wire-guard-network
slug: /other-wire-guard-network
title: wireGuard组网
authors: develop
---

# 使用 WireGuard 组网实现内网穿透

## 1.前提条件

**公网服务器：** 一台具有公网 IP 地址的 Linux 服务器

**端口开放：** 服务器中需要开放对应的**UDP**端口号

![](https://gitee.com/qixiangyang/pictures/raw/master/images/2026/01/20260113171701181.png)

## 2.服务端部署流程

> 查看服务器型号 

```shell showLineNumbers
lsb_release -a
```

> 安装wireguard

```shell showLineNumbers
apt install wireguard
```

> 查看wireguard的版本信息


```shell showLineNumbers
wg --version
```

> 创建文件夹 并切换当前目录

```shell showLineNumbers
mkdir -p /etc/wireguard

cd /etc/wireguard
```

> 生成服务端的公钥和私钥


```shell showLineNumbers
wg genkey | sudo tee /etc/wireguard/privatekey | wg pubkey | sudo tee /etc/wireguard/publickey
```

会在`/etc/wireguard`目录下生成`privatekey` 和`publickey`两个文件


> 这里的eth0 需要换成当前服务器自己的 命令如下

```shell showLineNumbers
ip -o -4 route show to default | awk '{print $5}'
```


> 下面是配置文件内容


```shell showLineNumbers title="wg0.conf"
[Interface]
Address = 10.0.0.1/24
SaveConfig = true
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
ListenPort = 51820
PrivateKey = <服务端私钥>

# Client，可以有很多 Peer
[Peer]
PublicKey = <用户端公钥>
AllowedIPs = 10.0.0.2/32  # 这个 Peer 只能是 10.100.0.2/32
# 如果想把所有流量都通过服务器的话，这样配置：
# AllowedIPs = 0.0.0.0/0, ::/0
```

## 3.服务端常用命令

> 启动

```shell showLineNumbers
wg-quick up wg0
```

> 停止

```shell showLineNumbers
wg-quick down wg0
```

> 重新载入配置文件

```shell showLineNumbers
wg syncconf wg0 <(wg-quick strip wg0)
```

## 4.客户端配置

> 客户端配置

```shell showLineNumbers
[Interface]
PrivateKey = <客户端私钥>
Address = 10.0.0.2/32
DNS = 8.8.8.8

[Peer]
PublicKey = <服务端公钥>
AllowedIPs = 10.0.0.0/24
Endpoint = 服务端ip:服务端端口号
PersistentKeepalive = 25
```

:::success 
客户端输入服务端的ip 加端口号 就可以访问服务端的信息了
:::

例如：http://10.10.100.1:9645/
